using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PortalOpenTestLevel : MonoBehaviour
{
    Animator anim;
    bool levelIsLoaded;
    string level;
    [SerializeField] GameObject testLevel;
    // Start is called before the first frame update
    void Start()
    {
        anim = GetComponent<Animator>();
    }

    void Update()
    {
        levelIsLoaded = GameManager.GetIsLevelLoaded();
    }

    private void OnTriggerEnter2D(Collider2D collision)
    {
        if(collision.tag == "Player" && !GameManager.playerIsReturningFromPortal)
        {
            collision.gameObject.transform.position = transform.position;

            if (GameManager.currentLevel == 0)
            {
                level = "PlatformerTestLevel";
            }
            else if (GameManager.currentLevel == 1)
            {
                level = "WaterTemple";
            }
            else
            {
                level = "PlatformerTestLevel";
            }
            StartCoroutine(EnterLevel());
        }
    }

    IEnumerator EnterLevel()
    {
        GameObject.Find("PortalTrigger").GetComponent<PortalTest>().animate = false;
        GameManager.playerIsInControl = false;
        GameManager.TurnCafeIntoAChildOfThePlayer(true);
        GameManager.OpenLevel(level);
        GameManager.EnableCafeCollisions(false);
        yield return new WaitUntil(() => levelIsLoaded);
        anim.Play("PortalEnterLevel");
        //testLevel.SetActive(true);
        GameManager.SetGameMode(1);
        GameManager.playerIsInControl = true;
        GameManager.levelExitPortalFinishedClosing = false;
    }

    private void CloseCafe()
    {
        GameManager.ActivateCafe(false);
    }

    private void ClosePlatformer()
    {
        GameManager.levelExitPortalFinishedClosing = true;
    }
}
